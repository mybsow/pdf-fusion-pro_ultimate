{% extends "base.html" %}

{% block title %}Accueil - PDF Fusion Pro – Outils PDF Gratuits{% endblock %}

{% block description %}Tous les outils PDF en un seul endroit : fusionner, diviser, tourner, compresser et convertir des fichiers PDF. 100% gratuit, sécurisé et sans inscription.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <h1 class="hero-title">Transformez vos PDFs en toute simplicité</h1>
    <p class="hero-subtitle">
        Outil PDF tout-en-un : fusion, division, rotation, compression et conversion. Rapide, sécurisé et 100% gratuit.
        <br>Aucune inscription requise – vos fichiers ne quittent jamais votre navigateur.
    </p>
</section>

<!-- Tools Grid -->
<div class="row g-4">
    <!-- Fusionner -->
    <div class="col-lg-6">
        <div class="tool-container active">
            <div class="tool-header">
                <h3><i class="fas fa-object-group me-2"></i>Fusionner des fichiers PDF</h3>
                <p class="text-muted mb-0">Combine plusieurs PDF en un seul document organisé</p>
            </div>
            <div class="tool-content">
                <div class="upload-zone" id="mergeUploadZone" onclick="document.getElementById('mergeFileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <h4>Glissez-déposez vos fichiers PDF</h4>
                        <p>ou cliquez pour sélectionner (max 10 fichiers, 50MB chacun)</p>
                    </div>
                    <input type="file" id="mergeFileInput" accept=".pdf" multiple style="display: none;" onchange="handleMergeFiles(this.files)">
                </div>
                
                <div class="file-list" id="mergeFileList"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="processMerge()" id="mergeButton" disabled>
                        <i class="fas fa-magic me-2"></i>Fusionner les PDFs
                    </button>
                    <button class="btn btn-outline" onclick="clearMergeFiles()">
                        <i class="fas fa-trash me-2"></i>Effacer la liste
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Diviser -->
    <div class="col-lg-6">
        <div class="tool-container">
            <div class="tool-header">
                <h3><i class="fas fa-cut me-2"></i>Diviser un fichier PDF</h3>
                <p class="text-muted mb-0">Extrayez des pages spécifiques ou divisez par plages</p>
            </div>
            <div class="tool-content">
                <div class="upload-zone" id="splitUploadZone" onclick="document.getElementById('splitFileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">
                        <h4>Sélectionnez un fichier PDF à diviser</h4>
                        <p>Glissez-déposez ou cliquez pour choisir</p>
                    </div>
                    <input type="file" id="splitFileInput" accept=".pdf" style="display: none;" onchange="handleSplitFile(this.files)">
                </div>
                
                <div class="file-list" id="splitFileInfo"></div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Mode de division</label>
                            <select class="form-select" id="splitMode" onchange="updateSplitMode()">
                                <option value="all">Chaque page séparément</option>
                                <option value="range">Plages de pages (ex: 1-3,5-7)</option>
                                <option value="selected">Pages spécifiques (ex: 1,4,8)</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label" id="splitArgLabel">Argument</label>
                            <input type="text" class="form-control" id="splitArg" 
                                   placeholder="Ex: 1-3, 5-7 ou 1,4,8">
                            <small class="text-muted" id="splitHelpText">
                                Laissez vide pour diviser toutes les pages
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="processSplit()" id="splitButton" disabled>
                        <i class="fas fa-cut me-2"></i>Diviser le PDF
                    </button>
                    <button class="btn btn-success" onclick="processSplitZip()" id="splitZipButton" disabled>
                        <i class="fas fa-file-archive me-2"></i>Télécharger en ZIP
                    </button>
                    <button class="btn btn-outline" onclick="generatePreview()" id="previewButton" disabled>
                        <i class="fas fa-eye me-2"></i>Aperçu
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tourner -->
    <div class="col-lg-6">
        <div class="tool-container">
            <div class="tool-header">
                <h3><i class="fas fa-sync-alt me-2"></i>Tourner un fichier PDF</h3>
                <p class="text-muted mb-0">Faites pivoter des pages spécifiques ou l'ensemble du document</p>
            </div>
            <div class="tool-content">
                <div class="upload-zone" id="rotateUploadZone" onclick="document.getElementById('rotateFileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">
                        <h4>Sélectionnez un fichier PDF à tourner</h4>
                        <p>Glissez-déposez ou cliquez pour choisir</p>
                    </div>
                    <input type="file" id="rotateFileInput" accept=".pdf" style="display: none;" onchange="handleRotateFile(this.files)">
                </div>
                
                <div class="file-list" id="rotateFileInfo"></div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Pages à tourner</label>
                            <input type="text" class="form-control" id="rotatePages" 
                                   placeholder="Ex: 1,3-5 ou laissez 'all' pour toutes">
                            <small class="text-muted">
                                Format: numéros séparés par des virgules, plages avec tiret
                            </small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Angle de rotation</label>
                            <select class="form-select" id="rotateAngle">
                                <option value="90">90° (Sens horaire)</option>
                                <option value="180">180° (Demi-tour)</option>
                                <option value="270">270° (Sens anti-horaire)</option>
                                <option value="-90">-90° (Sens anti-horaire)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="processRotate()" id="rotateButton" disabled>
                        <i class="fas fa-sync-alt me-2"></i>Tourner le PDF
                    </button>
                    <button class="btn btn-outline" onclick="resetRotateForm()">
                        <i class="fas fa-redo me-2"></i>Réinitialiser
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Compresser -->
    <div class="col-lg-6">
        <div class="tool-container">
            <div class="tool-header">
                <h3><i class="fas fa-compress-alt me-2"></i>Compresser un fichier PDF</h3>
                <p class="text-muted mb-0">Réduisez la taille de vos PDFs sans perte de qualité notable</p>
            </div>
            <div class="tool-content">
                <div class="upload-zone" id="compressUploadZone" onclick="document.getElementById('compressFileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">
                        <h4>Sélectionnez un fichier PDF à compresser</h4>
                        <p>Glissez-déposez ou cliquez pour choisir</p>
                    </div>
                    <input type="file" id="compressFileInput" accept=".pdf" style="display: none;" onchange="handleCompressFile(this.files)">
                </div>
                
                <div class="file-list" id="compressFileInfo"></div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    La compression réduit la taille du fichier en optimisant les images et en supprimant les métadonnées inutiles.
                    La qualité visuelle reste excellente pour la plupart des usages.
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="processCompress()" id="compressButton" disabled>
                        <i class="fas fa-compress-alt me-2"></i>Compresser le PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Container -->
<div class="preview-container" id="splitPreview" style="display: none;">
    <h5 class="preview-title"><i class="fas fa-eye me-2"></i>Aperçu des pages</h5>
    <div class="preview-grid" id="splitPreviewGrid"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// State Management
let state = {
    files: {
        merge: [],
        split: null,
        rotate: null,
        compress: null
    }
};

// File Upload Handlers
function handleMergeFiles(files) {
    const newFiles = Array.from(files).filter(file => 
        file.type === 'application/pdf' && file.size <= 50 * 1024 * 1024
    );
    
    if (newFiles.length === 0) {
        showToast('error', 'Format invalide', 'Seuls les fichiers PDF de moins de 50MB sont acceptés.');
        return;
    }

    state.files.merge = state.files.merge.concat(newFiles);
    if (state.files.merge.length > 10) {
        state.files.merge = state.files.merge.slice(0, 10);
        showToast('warning', 'Limite atteinte', 'Maximum 10 fichiers autorisés.');
    }

    updateMergeFileList();
    updateMergeButton();
}

function handleSplitFile(files) {
    if (!files || files.length === 0) return;
    
    const file = files[0];
    
    if (file.type !== 'application/pdf') {
        showToast('error', 'Format invalide', 'Veuillez sélectionner un fichier PDF.');
        return;
    }

    if (file.size > 50 * 1024 * 1024) {
        showToast('error', 'Fichier trop volumineux', 'La taille maximale est de 50MB.');
        return;
    }

    state.files.split = file;
    updateFileInfo('split');
    updateSplitButton();
    document.getElementById('previewButton').disabled = false;
}

function handleRotateFile(files) {
    if (!files || files.length === 0) return;
    
    const file = files[0];
    
    if (file.type !== 'application/pdf') {
        showToast('error', 'Format invalide', 'Veuillez sélectionner un fichier PDF.');
        return;
    }

    if (file.size > 50 * 1024 * 1024) {
        showToast('error', 'Fichier trop volumineux', 'La taille maximale est de 50MB.');
        return;
    }

    state.files.rotate = file;
    updateFileInfo('rotate');
    updateRotateButton();
}

function handleCompressFile(files) {
    if (!files || files.length === 0) return;
    
    const file = files[0];
    
    if (file.type !== 'application/pdf') {
        showToast('error', 'Format invalide', 'Veuillez sélectionner un fichier PDF.');
        return;
    }

    if (file.size > 50 * 1024 * 1024) {
        showToast('error', 'Fichier trop volumineux', 'La taille maximale est de 50MB.');
        return;
    }

    state.files.compress = file;
    updateFileInfo('compress');
    updateCompressButton();
}

// UI Updates
function updateMergeFileList() {
    const container = document.getElementById('mergeFileList');
    if (!container) return;

    if (state.files.merge.length === 0) {
        container.innerHTML = '';
        return;
    }

    container.innerHTML = state.files.merge.map((file, index) => `
        <div class="file-item">
            <div class="file-info">
                <div class="file-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="file-details">
                    <h6>${escapeHtml(file.name)}</h6>
                    <small>${formatFileSize(file.size)}</small>
                </div>
            </div>
            <div class="file-actions">
                <button class="btn btn-sm btn-outline" onclick="removeMergeFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function updateFileInfo(tool) {
    const container = document.getElementById(tool + 'FileInfo');
    if (!container || !state.files[tool]) {
        container.innerHTML = '';
        return;
    }

    const file = state.files[tool];
    container.innerHTML = `
        <div class="file-item">
            <div class="file-info">
                <div class="file-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="file-details">
                    <h6>${escapeHtml(file.name)}</h6>
                    <small>${formatFileSize(file.size)}</small>
                </div>
            </div>
            <div class="file-actions">
                <button class="btn btn-sm btn-outline" onclick="clearFile('${tool}')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    `;
}

// Button Updates
function updateMergeButton() {
    const button = document.getElementById('mergeButton');
    button.disabled = state.files.merge.length === 0;
}

function updateSplitButton() {
    const button = document.getElementById('splitButton');
    button.disabled = !state.files.split;
    document.getElementById('splitZipButton').disabled = !state.files.split;
}

function updateRotateButton() {
    const button = document.getElementById('rotateButton');
    button.disabled = !state.files.rotate;
}

function updateCompressButton() {
    const button = document.getElementById('compressButton');
    button.disabled = !state.files.compress;
}

// File Management
function removeMergeFile(index) {
    state.files.merge.splice(index, 1);
    updateMergeFileList();
    updateMergeButton();
}

function clearMergeFiles() {
    state.files.merge = [];
    updateMergeFileList();
    updateMergeButton();
}

function clearFile(tool) {
    state.files[tool] = tool === 'merge' ? [] : null;
    if (tool === 'merge') {
        updateMergeFileList();
        updateMergeButton();
    } else {
        updateFileInfo(tool);
        if (tool === 'split') {
            updateSplitButton();
            document.getElementById('previewButton').disabled = true;
            hideSplitPreview();
        } else if (tool === 'rotate') {
            updateRotateButton();
        } else if (tool === 'compress') {
            updateCompressButton();
        }
    }
}

// Split Mode Handling
function updateSplitMode() {
    const mode = document.getElementById('splitMode').value;
    const argLabel = document.getElementById('splitArgLabel');
    const argInput = document.getElementById('splitArg');
    const helpText = document.getElementById('splitHelpText');

    switch (mode) {
        case 'all':
            argLabel.textContent = 'Argument (optionnel)';
            argInput.placeholder = 'Laissez vide pour toutes les pages';
            helpText.textContent = 'Laissez vide pour diviser toutes les pages';
            break;
        case 'range':
            argLabel.textContent = 'Plages de pages';
            argInput.placeholder = 'Ex: 1-3, 5-7, 10-12';
            helpText.textContent = 'Séparez les plages par des virgules (ex: 1-3,5-7)';
            break;
        case 'selected':
            argLabel.textContent = 'Pages spécifiques';
            argInput.placeholder = 'Ex: 1, 4, 8, 12';
            helpText.textContent = 'Séparez les numéros de page par des virgules';
            break;
    }
}

// Preview Functions
function hideSplitPreview() {
    const container = document.getElementById('splitPreview');
    container.style.display = 'none';
}

// Drag & Drop Setup
function setupDragAndDrop() {
    ['merge', 'split', 'rotate', 'compress'].forEach(tool => {
        const zone = document.getElementById(tool + 'UploadZone');
        if (!zone) return;

        zone.addEventListener('dragover', function(e) {
            e.preventDefault();
            zone.classList.add('drag-over');
        });

        zone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            zone.classList.remove('drag-over');
        });

        zone.addEventListener('drop', function(e) {
            e.preventDefault();
            zone.classList.remove('drag-over');
            
            if (tool === 'merge') {
                handleMergeFiles(e.dataTransfer.files);
            } else {
                if (tool === 'split') handleSplitFile(e.dataTransfer.files);
                else if (tool === 'rotate') handleRotateFile(e.dataTransfer.files);
                else if (tool === 'compress') handleCompressFile(e.dataTransfer.files);
            }
        });
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    setupDragAndDrop();
    updateSplitMode();
    
    // Initialiser AdSense pour cette page
    setTimeout(() => {
        try {
            const ads = document.querySelectorAll('.adsbygoogle');
            ads.forEach(ad => {
                if (!ad.getAttribute('data-adsbygoogle-status')) {
                    (adsbygoogle = window.adsbygoogle || []).push({});
                }
            });
        } catch (e) {
            console.log('AdSense error:', e);
        }
    }, 1000);
});

// Make functions globally available
window.removeMergeFile = removeMergeFile;
window.clearMergeFiles = clearMergeFiles;
window.clearFile = clearFile;
window.updateSplitMode = updateSplitMode;
window.hideSplitPreview = hideSplitPreview;
</script>
{% endblock %}