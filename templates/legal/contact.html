{% extends "base_legal.html" %}

{% block content %}
<div class="info-box">
    <i class="fas fa-info-circle me-2"></i>
    <strong>{{ _('Formulaire de contact :') }}</strong> 
    {{ _('Utilisez ce formulaire pour nous contacter directement. Nous vous r√©pondrons dans les meilleurs d√©lais.') }}
</div>

<h2>{{ _('Formulaire de Contact') }}</h2>
<p>{{ _('Remplissez ce formulaire pour nous contacter. Tous les champs marqu√©s d\'un ast√©risque (*) sont obligatoires.') }}</p>

{% if success %}
    <div class="alert alert-success" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <strong>{{ _('Message enregistr√© avec succ√®s !') }}</strong><br>
        <small>
            {{ _('R√©f√©rence:') }} {{ datetime.now().strftime('%H:%M') }} ‚Ä¢ 
            {{ _('Merci pour votre message.') }}
        </small><br>
        {{ _('Nous avons bien re√ßu votre demande et nous vous r√©pondrons dans les plus brefs d√©lais.') }}
    </div>

    <div class="text-center mt-4">
        <a href="/" class="btn btn-primary me-2">
            <i class="fas fa-home me-1"></i> {{ _('Retour √† l\'accueil') }}
        </a>
        <a href="/contact" class="btn btn-outline-primary">
            <i class="fas fa-envelope me-1"></i> {{ _('Envoyer un autre message') }}
        </a>
    </div>

{% else %}

    {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong>{{ _('Attention :') }}</strong> {{ error }}
        </div>
    {% endif %}

    <div class="contact-form-container">
        <form method="POST" action="/contact">
            {{ form.hidden_tag() }}

            <div class="mb-3">
                <label for="full_name" class="form-label">{{ _('Nom complet') }} *</label>
                <input type="text"
                       class="form-control"
                       id="full_name"
                       name="full_name"
                       placeholder="{{ _('Votre pr√©nom et nom') }}"
                       required
                       minlength="2"
                       maxlength="100"
                       value="{{ form_data.get('full_name', '') }}">
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">{{ _('Adresse email') }} *</label>
                    <input type="email"
                           class="form-control"
                           id="email"
                           name="email"
                           placeholder="votre@email.com"
                           required
                           value="{{ form_data.get('email', '') }}">
                    <div class="form-text">
                        {{ _('Nous ne partagerons jamais votre email avec des tiers.') }}
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="phone" class="form-label">
                        {{ _('Num√©ro de t√©l√©phone (optionnel)') }}
                    </label>
                    <input type="tel"
                           class="form-control"
                           id="phone"
                           name="phone"
                           placeholder="06 12 34 56 78"
                           value="{{ form_data.get('phone', '') }}">
                    <div class="form-text">
                        {{ _('Pour un contact plus rapide si n√©cessaire.') }}
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="subject" class="form-label">
                    {{ _('Sujet de votre message') }} *
                </label>
                <select class="form-select" id="subject" name="subject" required>
                    <option value="" disabled
                        {% if not form_data.get('subject') %}selected{% endif %}>
                        {{ _('S√©lectionnez un sujet') }}
                    </option>

                    <option value="bug"
                        {% if form_data.get('subject') == 'bug' %}selected{% endif %}>
                        üö® {{ _('Signaler un bug ou un probl√®me technique') }}
                    </option>

                    <option value="improvement"
                        {% if form_data.get('subject') == 'improvement' %}selected{% endif %}>
                        üí° {{ _('Proposer une am√©lioration fonctionnelle') }}
                    </option>

                    <option value="partnership"
                        {% if form_data.get('subject') == 'partnership' %}selected{% endif %}>
                        ü§ù {{ _('Demande de partenariat') }}
                    </option>

                    <option value="other"
                        {% if form_data.get('subject') == 'other' %}selected{% endif %}>
                        ‚ùì {{ _('Autre demande') }}
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label for="message" class="form-label">
                    {{ _('Votre message') }} *
                </label>

                <textarea class="form-control"
                          id="message"
                          name="message"
                          rows="6"
                          required
                          maxlength="2000"
                          placeholder="{{ _('D√©crivez votre demande en d√©tail...') }}">{{ form_data.get('message', '') }}</textarea>

                <div class="character-count" id="charCount">
                    0 / 2000 {{ _('caract√®res') }}
                </div>

                <div class="form-text">
                    {{ _('Maximum 2000 caract√®res. Soyez aussi pr√©cis que possible.') }}
                </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-send">
                    <i class="fas fa-paper-plane me-1"></i>
                    {{ _('Envoyer le message') }}
                </button>
            </div>
        </form>
    </div>

{% endif %}
{% endblock %}


{% block extra_js %}
<script>
(function () {

    function initCharCounter() {
        const textarea = document.getElementById('message');
        const counter = document.getElementById('charCount');
        const label = "{{ _('caract√®res') }}";

        if (!textarea || !counter) return;

        function update() {
            const length = textarea.value.length;
            counter.textContent = length + " / 2000 " + label;

            counter.classList.remove('warning', 'danger');

            if (length > 1900) {
                counter.classList.add('danger');
            } else if (length > 1500) {
                counter.classList.add('warning');
            }
        }

        textarea.addEventListener('input', update);
        update();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCharCounter);
    } else {
        initCharCounter();
    }

})();
</script>
{% endblock %}
