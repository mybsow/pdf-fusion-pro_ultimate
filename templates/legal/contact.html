{% extends "base_legal.html" %}

{% block content %}
<div class="info-box">
    <i class="fas fa-info-circle me-2"></i>
    <strong>Formulaire de contact :</strong> Utilisez ce formulaire pour nous contacter directement.
    Nous vous r√©pondrons dans les meilleurs d√©lais.
</div>

<h2>Formulaire de Contact</h2>
<p>Remplissez ce formulaire pour nous contacter. Tous les champs marqu√©s d'un ast√©risque (*) sont obligatoires.</p>

{% if success %}
    <div class="alert alert-success" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <strong>Message enregistr√© avec succ√®s !</strong><br>
        <small>R√©f√©rence: {{ datetime.now().strftime('%H:%M') }} ‚Ä¢ Merci pour votre message.</small><br>
        Nous avons bien re√ßu votre demande et nous vous r√©pondrons dans les plus brefs d√©lais.
    </div>
    
    <div class="text-center mt-4">
        <a href="/" class="btn btn-primary me-2">
            <i class="fas fa-home me-1"></i> Retour √† l'accueil
        </a>
        <a href="/contact" class="btn btn-outline-primary">
            <i class="fas fa-envelope me-1"></i> Envoyer un autre message
        </a>
    </div>
{% else %}
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong>Attention :</strong> {{ error }}
        </div>
    {% endif %}
    
    <div class="contact-form-container">
        <form method="POST" action="/contact">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="first_name" class="form-label">Pr√©nom *</label>
                    <input type="text" class="form-control" id="first_name" name="first_name" 
                           placeholder="Votre pr√©nom" required
                           value="{{ form_data.get('first_name', '') }}"
                           minlength="2" maxlength="50">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="last_name" class="form-label">Nom *</label>
                    <input type="text" class="form-control" id="last_name" name="last_name" 
                           placeholder="Votre nom" required
                           value="{{ form_data.get('last_name', '') }}"
                           minlength="2" maxlength="50">
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Adresse email *</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           placeholder="votre@email.com" required
                           value="{{ form_data.get('email', '') }}">
                    <div class="form-text">Nous ne partagerons jamais votre email avec des tiers.</div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="phone" class="form-label">Num√©ro de t√©l√©phone (optionnel)</label>
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           placeholder="06 12 34 56 78"
                           value="{{ form_data.get('phone', '') }}">
                    <div class="form-text">Pour un contact plus rapide si n√©cessaire.</div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="subject" class="form-label">Sujet de votre message *</label>
                <select class="form-select" id="subject" name="subject" required>
                    <option value="" disabled selected>S√©lectionnez un sujet</option>
                    <option value="bug" {% if form_data.get('subject') == 'bug' %}selected{% endif %}>üö® Signaler un bug ou un probl√®me technique</option>
                    <option value="improvement" {% if form_data.get('subject') == 'improvement' %}selected{% endif %}>üí° Proposer une am√©lioration fonctionnelle</option>
                    <option value="partnership" {% if form_data.get('subject') == 'partnership' %}selected{% endif %}>ü§ù Demande de partenariat</option>
                    <option value="other" {% if form_data.get('subject') == 'other' %}selected{% endif %}>‚ùì Autre demande</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="message" class="form-label">Votre message *</label>
                <textarea class="form-control" id="message" name="message" rows="6" 
                          placeholder="D√©crivez votre demande en d√©tail..." required
                          maxlength="2000">{{ form_data.get('message', '') }}</textarea>
                <div class="character-count" id="charCount">0 / 2000 caract√®res</div>
                <div class="form-text">Maximum 2000 caract√®res. Soyez aussi pr√©cis que possible.</div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-send">
                    <i class="fas fa-paper-plane me-1"></i> Envoyer le message
                </button>
            </div>
        </form>
    </div>
    
    <h3 class="mt-5">Types de demandes</h3>
    <p>Voici les diff√©rents types de demandes que vous pouvez nous soumettre :</p>
    
    <div class="contact-types-grid">
        <div class="contact-type-card">
            <div class="contact-type-icon">
                <i class="fas fa-bug"></i>
            </div>
            <h4>Support technique</h4>
            <p>Pour signaler un bug, un probl√®me technique ou une difficult√© d'utilisation du service.</p>
        </div>
        
        <div class="contact-type-card">
            <div class="contact-type-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <h4>Am√©liorations</h4>
            <p>Pour proposer une nouvelle fonctionnalit√© ou sugg√©rer une am√©lioration du service.</p>
        </div>
        
        <div class="contact-type-card">
            <div class="contact-type-icon">
                <i class="fas fa-handshake"></i>
            </div>
            <h4>Partenariats</h4>
            <p>Pour discuter d'opportunit√©s de collaboration, d'int√©gration ou de partenariat.</p>
        </div>
        
        <div class="contact-type-card">
            <div class="contact-type-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <h4>Autres demandes</h4>
            <p>Pour toute autre question concernant le service, la confidentialit√© ou les conditions d'utilisation.</p>
        </div>
    </div>
    
    <div class="info-box mt-4">
        <i class="fas fa-clock me-2"></i>
        <strong>Temps de r√©ponse :</strong> Nous nous effor√ßons de r√©pondre √† tous les messages dans un d√©lai de 48 heures.
        Pour les urgences techniques, pr√©cisez-le dans votre message.
    </div>
    
    <div class="alert alert-warning mt-4">
        <i class="fas fa-exclamation-circle me-2"></i>
        <strong>Note importante :</strong> Pour des raisons de s√©curit√© et de confidentialit√©, 
        nous ne traitons pas les demandes concernant des fichiers PDF sp√©cifiques via ce formulaire.
        Tous les traitements de fichiers doivent √™tre effectu√©s directement via l'interface web.
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Th√®me sombre/clair automatique
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
    }
    
    // Gestion du compteur de caract√®res
    document.addEventListener('DOMContentLoaded', function() {
        const messageTextarea = document.getElementById('message');
        const charCount = document.getElementById('charCount');
        
        if (messageTextarea && charCount) {
            function updateCharCount() {
                const length = messageTextarea.value.length;
                charCount.textContent = `${length} / 2000 caract√®res`;
                
                charCount.classList.remove('warning', 'danger');
                if (length > 1500) {
                    charCount.classList.add('warning');
                }
                if (length > 1900) {
                    charCount.classList.add('danger');
                }
            }
            
            messageTextarea.addEventListener('input', updateCharCount);
            updateCharCount(); // Initial call
        }
    });
</script>
{% endblock %}
