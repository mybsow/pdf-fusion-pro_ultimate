<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Évaluations – Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    function confirmDelete(ratingId) {
      if (confirm('Supprimer cette évaluation ?')) {
        window.location.href = '/admin/ratings?delete=' + ratingId;
      }
    }

    function exportJSON() {
      window.location.href = '/admin/ratings?export=json';
    }
  </script>
</head>
<body class="container mt-4">

<h1>
  Évaluations
  {% if stats.unseen %}
    <span class="badge bg-danger">{{ stats.unseen }} nouvelles</span>
  {% endif %}
</h1>

<p>⭐ Moyenne : <strong>{{ stats.average }}</strong> / 5</p>

<div class="mb-3">
  <button class="btn btn-success me-2" onclick="exportJSON()">
    Exporter JSON
  </button>
  <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary">Retour au Dashboard</a>
</div>

<table class="table table-striped">
<thead>
<tr>
  <th>Date</th>
  <th>Note</th>
  <th>Feedback</th>
  <th>Page</th>
  <th>Actions</th>
</tr>
</thead>
<tbody>
{% for r in ratings %}
<tr>
  <td>{{ r.display_date }}</td>
  <td>{{ "⭐" * r.rating }}</td>
  <td>{{ r.feedback or "-" }}</td>
  <td>{{ r.page }}</td>
  <td>
    <button class="btn btn-danger btn-sm" onclick="confirmDelete('{{ r.id }}')">
      Supprimer
    </button>
  </td>
</tr>
{% endfor %}
</tbody>
</table>

<a href="{{ url_for('admin.admin_logout') }}" class="btn btn-outline-secondary">Déconnexion</a>

</body>
</html>
