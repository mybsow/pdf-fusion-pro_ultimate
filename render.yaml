services:
  - type: web
    name: pdf-fusion-pro-ultimate
    repo: https://github.com/mybsow/pdf-fusion-pro_ultimate
    region: frankfurt
    plan: free
    branch: main
    autoDeploy: true

    # âœ… DÃ‰SACTIVER POETRY EXPLICITEMENT
    envVars:
      - key: POETRY_VIRTUALENVS_CREATE
        value: "false"
      - key: POETRY_VIRTUALENVS_IN_PROJECT
        value: "false"
      - key: PIP_NO_CACHE_DIR
        value: "1"
      - key: PORT
        value: "10000"
      - key: OCR_ENABLED
        value: "true"

    # âœ… BUILD COMMAND CORRECT
    buildCommand: |
      ./build.sh
      echo "ðŸš€ BUILD PDF FUSION PRO - DÃ‰SACTIVATION POETRY"
      
      # DÃ©sactiver Poetry
      export POETRY_VIRTUALENVS_CREATE=false
      export PIP_NO_CACHE_DIR=1
      
      # 1. Installer Tesseract
      apt-get update
      apt-get install -y tesseract-ocr tesseract-ocr-fra poppler-utils
      
      # 2. VÃ©rifier
      echo "âœ… Tesseract: $(which tesseract)"
      tesseract --version
      
      # 3. Installer pip packages
      pip install --upgrade pip
      pip install pytesseract==0.3.10 pdf2image==1.16.3 Pillow==10.0.0
      pip install Flask==3.0.0 gunicorn==21.2.0
      
      # 4. Installer depuis requirements.txt
      if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
      fi
      
      echo "âœ… BUILD TERMINÃ‰"

    startCommand: gunicorn --bind 0.0.0.0:$PORT --workers 1 app:app

    # âœ… Packages systÃ¨me
    aptPackages:
      - tesseract-ocr
      - tesseract-ocr-fra
      - poppler-utils

    healthCheckPath: /health
    healthCheckTimeout: 30

